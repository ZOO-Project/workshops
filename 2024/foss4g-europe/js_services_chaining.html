

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Playing with building blocks &mdash; ZOO-Project 1.7 documentation</title>
  
  <link href="http://fonts.googleapis.com/css?family=Days+One" rel="stylesheet" type="text/css">
  
  

  

  
  
    
      <link rel="search" type="application/opensearchdescription+xml" title="Search within ZOO-Project 1.7 documentation" href="../../_static/opensearch.xml"/>
    

  

  
  

  
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="ZOO-Project 1.7 documentation" href="../../index.html"/>
        <link rel="up" title="ZOO-Project – Introduction to OGC API - Processes - Part 1: Core" href="index.html"/>
        <link rel="next" title="Issue playing with building blocks?" href="solutions.html"/>
        <link rel="prev" title="Building blocks presentation" href="building_blocks_presentation.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        

        
	  <a class="shrink" href="http://zoo-project.org"><img src="http://zoo-project.org/img/zoo-sun-logo.png" class="img-responsive sun" style="display: inline;"> ZOO</a>
        

        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">ZOO-Project – Introduction to OGC API - Processes - Part 1: Core</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="using_zoo_from_docker.html">Installation, configuration and ZOO-Kernel use</a></li>
<li class="toctree-l2"><a class="reference internal" href="first_service.html">Creating your first ZOO-Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="building_blocks_presentation.html">Building blocks presentation</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Playing with building blocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="solutions.html">Issue playing with building blocks?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../2023/foss4g/index.html">ZOO-Project – Introduction to OGC API - Processes - Part 1: Core</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../2023/foss4g/introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2023/foss4g/using_zoo_from_docker.html">Installation, configuration and ZOO-Kernel use</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2023/foss4g/first_service.html">Creating your first ZOO Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2023/foss4g/building_blocks_presentation.html">Building blocks presentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2023/foss4g/js_services_chaining.html">Playing with building blocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2023/foss4g/solutions.html">Issue playing with building blocks?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../2023/ogc-member-meeting/index.html">ZOO-Project introduction to OGC API - Processes - Part 1: Core secutiy</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../2023/ogc-member-meeting/introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2023/ogc-member-meeting/using_zoo_from_docker.html">Installation, configuration and ZOO-Kernel use</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2023/ogc-member-meeting/setup_security_basicauth.html">Secure access to specific end-points using HTTP Basic Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2023/ogc-member-meeting/setup_security_openid_connect.html">Using OpenID Connect 1.0 to authenticate</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../2022/index.html">ZOO-Project workshop 2022</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../2022/introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2022/using_zoo_from_docker.html">Installation, configuration and ZOO-Kernel use</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2022/first_service.html">Creating your first ZOO Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2022/building_blocks_presentation.html">Building blocks presentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2022/js_services_chaining.html">Playing with building blocks</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../2017/index.html">ZOO-Project workshop 2017</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../2017/introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2017/using_zoo_from_osgeolivevm.html">Configuration and ZOO-Kernel use</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2017/first_service.html">Creating your first ZOO Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2017/building_blocks_presentation.html">Building blocks presentation - Using OGR and PgRouting based Web Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2017/js_services_chaining.html">Playing with buildign blocks - Creating JavaScript Web Services</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../2016/index.html">ZOO-Project workshop 2016</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../2016/introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2016/using_zoo_from_osgeolivevm.html">Configuration and ZOO-Kernel use</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2016/first_service.html">Creating your first ZOO Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2016/building_blocks_presentation.html">Building blocks presentation - Using OGR and PgRouting based Web Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2016/js_services_chaining.html">Playing with buildign blocks - Creating JavaScript Web Services</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../2015/index.html">ZOO-Project workshop 2015</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../2015/introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2015/using_zoo_from_osgeolivevm.html">Configuration and ZOO-Kernel use</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2015/first_service.html">Creating your first ZOO Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2015/building_blocks_presentation.html">Building blocks presentation - Using OGR and PgRouting based Web Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2015/js_services_chaining.html">Playing with buildign blocks - Creating JavaScript Web Services</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../2014/index.html">ZOO-Project workshop 2014</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../2014/introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2014/using_zoo_from_osgeolivevm.html">Configuration and ZOO-Kernel use</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2014/first_service.html">Creating your first ZOO Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2014/building_blocks_presentation.html">Building blocks presentation - Using OGR and PgRouting based Web Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2014/js_services_chaining.html">Playing with buildign blocks - Creating JavaScript Web Services</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../2013/index.html">ZOO-Project Workshop 2013</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../2013/introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2013/using_zoo_from_osgeolivevm.html">Configuration and ZOO-Kernel use</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2013/first_service.html">Create your first ZOO Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2013/building_blocks_presentation.html">Building blocks presentation - Using OGR and PgRouting based Web Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2013/js_services_chaining.html">Playing with buildign blocks - Creating JavaScript Web Services</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../2012/index.html">ZOO-Project Workshop 2012</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../2012/introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2012/using_zoo_from_osgeolivevm.html">Configuration and ZOO-Kernel use</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2012/first_service.html">Creating your first ZOO Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2012/building_blocks_presentation.html">Presenting building blocks - Using OGR based Web Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2012/js_services_chaining.html">Playing with buildign blocks - Creating JavaScript Web Services</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../2010/index.html">ZOO-Project Workshop 2010</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../2010/introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2010/using_zoo_from_osgeolivevm.html">Using ZOO from an OSGeoLive virtual machine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2010/ogr_base_vect_ops.html">Creating OGR based Web Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2010/building_wps_client_using_ol.html">Building a WPS client using OpenLayers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2010/exercise.html">Exercise</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">ZOO-Project</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">

    <li><a href="../../index.html"> Workshops</a> &#8725; &#160;</li>
      
          <li><a href="index.html">ZOO-Project – Introduction to OGC API - Processes - Part 1: Core</a> &#8725; &#160;</li>
      
    <li>Playing with building blocks</li>
      <li class="wy-breadcrumbs-aside">
        $Date$
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <section id="playing-with-building-blocks">
<span id="js-service-chaining"></span><h1><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Playing with building blocks</a><a class="headerlink" href="#playing-with-building-blocks" title="Link to this heading">¶</a></h1>
<a class="reference internal image-reference" href="https://www.svgrepo.com/show/382879/building-blocks-lego-toy.svg"><img alt="https://www.svgrepo.com/show/382879/building-blocks-lego-toy.svg" class="align-left" src="https://www.svgrepo.com/show/382879/building-blocks-lego-toy.svg" width="50px" /></a>
<nav class="contents" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#playing-with-building-blocks" id="id12">Playing with building blocks</a></p>
<ul>
<li><p><a class="reference internal" href="#introduction" id="id13">Introduction</a></p></li>
<li><p><a class="reference internal" href="#zoo-api-overview" id="id14">ZOO-API Overview</a></p></li>
<li><p><a class="reference internal" href="#the-mask-service" id="id15">The Mask Service</a></p>
<ul>
<li><p><a class="reference internal" href="#the-zcfg" id="id16">The ZCFG</a></p></li>
<li><p><a class="reference internal" href="#the-javascript-service" id="id17">The JavaScript service</a></p></li>
<li><p><a class="reference internal" href="#publish-and-use-your-service" id="id18">Publish and use your Service</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#buffermask-service" id="id19">BufferMask Service</a></p>
<ul>
<li><p><a class="reference internal" href="#id6" id="id20">The ZCFG</a></p></li>
<li><p><a class="reference internal" href="#id7" id="id21">The JavaScript service</a></p></li>
<li><p><a class="reference internal" href="#id8" id="id22">Publish and use your Service</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#bufferrequest-service" id="id23">BufferRequest service</a></p>
<ul>
<li><p><a class="reference internal" href="#id10" id="id24">The ZCFG</a></p></li>
<li><p><a class="reference internal" href="#the-javascript-code" id="id25">The JavaScript code</a></p></li>
<li><p><a class="reference internal" href="#id11" id="id26">Publish and use your Service</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#conclusion" id="id27">Conclusion</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="introduction">
<h2><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Introduction</a><a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h2>
<p>This section illustrate how you can use JavaScript on the server-side to chain
services together to build new ones. You will create a ZOO Services Provider
using the services you seen before and the WFS server using the ZOO-API. The
final goal is to query all POIs included in a buffer around a feature and
to highlight them using a mask around this buffer. The following screenshot show
you the expected result:</p>
<a class="reference internal image-reference" href="../../_images/BufferMaskAndRequest_Level_155.png"><img alt="../../_images/BufferMaskAndRequest_Level_155.png" class="align-center" src="../../_images/BufferMaskAndRequest_Level_155.png" style="width: 650px;" />
</a>
<p>You can decompose the result above in two different ones: the mask around the
buffer and the points included in the buffer. So you will create two different
Services: one called <code class="docutils literal notranslate"><span class="pre">BufferMask</span></code> and another one called <code class="docutils literal notranslate"><span class="pre">BufferRequest</span></code>.</p>
<p>But before implementing any JavaScript Service, you will get an overview of how
to use ZOO-API from your ZOO-Project installation in the next section.</p>
<p>As before, you first create a new directory to store files for your new Services
Provider:</p>
<div class="highlight-guess notranslate"><div class="highlight"><pre><span></span>mkdir myChain/
</pre></div>
</div>
</section>
<section id="zoo-api-overview">
<h2><a class="toc-backref" href="#table-of-contents" role="doc-backlink">ZOO-API Overview</a><a class="headerlink" href="#zoo-api-overview" title="Link to this heading">¶</a></h2>
<p>ZOO-API and ZOO-Kernel JavaScript support make you able to run services
implemented in JavaScript on the server side. JavaScript is a popular programing
language but mostly used on the client side. Let say from a browser, but here it
is a bit different.</p>
<p>To support JavaScript language ZOO-Kernel use the
<a class="reference external" href="https://developer.mozilla.org/en/SpiderMonkey">SpiderMonkey</a> API
to create a javascript runtime environment from which it will load
your JS file then extract the function corresponding to the service to
run it using the prefilled parameters. The JavaScript runtime
environment created by the ZOO-Kernel depend on your setup. If you
placed the <code class="docutils literal notranslate"><span class="pre">ZOO-api.js</span></code> and <code class="docutils literal notranslate"><span class="pre">ZOO-proj4js.js</span></code> in the same directory
as your ZOO-Kernel it means that your environment will contains
ZOO-API and Proj4js which will be loaded before your service. In such
case you can access to the Classes defined in the JavaScript ZOO-API
to manipulate geographic data, for more informations please refer to
the <a class="reference external" href="http://zoo-project.org/docs/api/index.html">ZOO-API Documentation</a>.</p>
<p>Even if it can be useful to run JavaScript on the server side, you should
remember that some basic JavaScript functions you are familiar with does not
exist or get a different behavior. For instance the simple <code class="docutils literal notranslate"><span class="pre">alert</span></code>
function will display messages in apache error logs rather than in a window when
used from a browser. The <code class="docutils literal notranslate"><span class="pre">alert</span></code> function can be used as follow:</p>
<div class="highlight-guess notranslate"><div class="highlight"><pre><span></span>alert(&quot;My alert message&quot;);
</pre></div>
</div>
<p>There is no XMLHttpRequest available in the JavaScript evironement your service
will run into. Hopefully, the ZOO-Kernel expose a C function to the JavaScript
world named: <code class="docutils literal notranslate"><span class="pre">JSRequest</span></code>. This function make you able from your JavaScript
services to call other WPS services (locally or remotelly) or other kind OGC
services such as WFS. When you are using the ZOO-API it is possible to call
Services using a <code class="docutils literal notranslate"><span class="pre">ZOO.Process</span></code> instance <a class="footnote-reference brackets" href="#f3" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>, to parse WPS Responses using
<code class="docutils literal notranslate"><span class="pre">ZOO.Format.WPS</span></code>
(cf. <a class="reference external" href="http://zoo-project.org/docs/api/zoo-process.html">ref</a>).</p>
<p>As for Python services you already seen in previous sections, the functions
corresponding to a Service should take three arguments: <code class="docutils literal notranslate"><span class="pre">conf</span></code>,
<code class="docutils literal notranslate"><span class="pre">inputs</span></code> and <code class="docutils literal notranslate"><span class="pre">outputs</span></code> <a class="footnote-reference brackets" href="#f4" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>. Nevertheless, as the ZOO-Kernel is
not able to access the values modified <a class="footnote-reference brackets" href="#f5" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a> by the Service code,
rather than returning an integer as in Python, here you’ll need to
return both the integer value and the resulting <code class="docutils literal notranslate"><span class="pre">outputs</span></code>  values as
an Object <a class="footnote-reference brackets" href="#f6" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a>. You can see in the following an example of a
JavaScript  Service code:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>function SampleService(conf,inputs,outputs){
  outputs[&quot;Result&quot;][&quot;value&quot;]=someComputation(inputs);
  return
    {
        result: ZOO.SERVICE_SUCCEEDED,
        outputs: outputs
    };
}
</pre></div>
</div>
<p>Before starting to implement the Services we will need to get our final
BufferRequest service, let start with a simplier one.</p>
</section>
<section id="the-mask-service">
<h2><a class="toc-backref" href="#table-of-contents" role="doc-backlink">The Mask Service</a><a class="headerlink" href="#the-mask-service" title="Link to this heading">¶</a></h2>
<p>In this section you will learn how to create your first JavaScript service which
will simply return a rectangular mask around a selected feature. To build this
mask you will use the Buffer service to create a buffer big enough around a
selected geometry to cover a significant part of your map. You can see the
expected result in the following screenshot:</p>
<a class="reference internal image-reference" href="../../_images/Mask_Level_128.png"><img alt="../../_images/Mask_Level_128.png" class="align-center" src="../../_images/Mask_Level_128.png" style="width: 650px;" />
</a>
<p>As before, you will first start by writting the ZCFG, then you will write the
JavaScript source code and finish by publishing your Services Provider.</p>
<section id="the-zcfg">
<h3><a class="toc-backref" href="#table-of-contents" role="doc-backlink">The ZCFG</a><a class="headerlink" href="#the-zcfg" title="Link to this heading">¶</a></h3>
<p>Open a file named
<code class="docutils literal notranslate"><span class="pre">myChain/Mask.zcfg</span></code>
with your favorite text editor and add the following content:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">Mask</span><span class="p">]</span>
 <span class="n">Title</span> <span class="o">=</span> <span class="n">Compute</span> <span class="n">mask</span>
 <span class="n">Abstract</span> <span class="o">=</span> <span class="n">Compute</span> <span class="n">mask</span> <span class="n">around</span> <span class="n">a</span> <span class="n">geometry</span>
 <span class="n">processVersion</span> <span class="o">=</span> <span class="mi">1</span>
 <span class="n">storeSupported</span> <span class="o">=</span> <span class="n">true</span>
 <span class="n">statusSupported</span> <span class="o">=</span> <span class="n">true</span>
 <span class="n">serviceProvider</span> <span class="o">=</span> <span class="n">foss4gws</span><span class="o">.</span><span class="n">js</span>
 <span class="n">serviceType</span> <span class="o">=</span> <span class="n">JS</span>
 <span class="o">&lt;</span><span class="n">DataInputs</span><span class="o">&gt;</span>
  <span class="p">[</span><span class="n">InputData</span><span class="p">]</span>
   <span class="n">Title</span> <span class="o">=</span> <span class="n">The</span> <span class="n">feature</span>
   <span class="n">Abstract</span> <span class="o">=</span> <span class="n">The</span> <span class="n">feature</span> <span class="n">to</span> <span class="n">run</span> <span class="n">the</span> <span class="n">service</span> <span class="k">with</span>
   <span class="n">minOccurs</span> <span class="o">=</span> <span class="mi">1</span>
   <span class="n">maxOccurs</span> <span class="o">=</span> <span class="mi">1</span>
   <span class="o">&lt;</span><span class="n">ComplexData</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">Default</span><span class="o">&gt;</span>
    <span class="n">mimeType</span> <span class="o">=</span> <span class="n">text</span><span class="o">/</span><span class="n">xml</span>
    <span class="n">encoding</span> <span class="o">=</span> <span class="n">utf</span><span class="o">-</span><span class="mi">8</span>
    <span class="o">&lt;/</span><span class="n">Default</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">ComplexData</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">DataInputs</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">DataOutputs</span><span class="o">&gt;</span>
  <span class="p">[</span><span class="n">Result</span><span class="p">]</span>
   <span class="n">Title</span> <span class="o">=</span> <span class="n">The</span> <span class="n">resulting</span> <span class="n">feature</span>
   <span class="n">Abstract</span> <span class="o">=</span> <span class="n">The</span> <span class="n">feature</span> <span class="n">created</span> <span class="n">by</span> <span class="n">the</span> <span class="n">service</span><span class="o">.</span>
   <span class="o">&lt;</span><span class="n">ComplexOutput</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">Default</span><span class="o">&gt;</span>
     <span class="n">mimeType</span> <span class="o">=</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span>
     <span class="o">&lt;/</span><span class="n">Default</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">ComplexOutput</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">DataOutputs</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Here you simply define one default <code class="docutils literal notranslate"><span class="pre">ComplexData</span></code> for both <code class="docutils literal notranslate"><span class="pre">inputData</span></code> and
<code class="docutils literal notranslate"><span class="pre">Result</span></code>: a GML and a GeoJSON respectively <a class="footnote-reference brackets" href="#f7" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>5<span class="fn-bracket">]</span></a>.</p>
</section>
<section id="the-javascript-service">
<h3><a class="toc-backref" href="#table-of-contents" role="doc-backlink">The JavaScript service</a><a class="headerlink" href="#the-javascript-service" title="Link to this heading">¶</a></h3>
<p>As you will have to request the Buffer service many times from your service, you
will first define <code class="docutils literal notranslate"><span class="pre">Buffer</span></code> and <code class="docutils literal notranslate"><span class="pre">BufferToBBOX</span></code> functions as
follow. It uses the <code class="docutils literal notranslate"><span class="pre">ZOO.Process</span></code> to request the Buffer service you
seen in the previous section.</p>
<p>Open a file named
<code class="docutils literal notranslate"><span class="pre">myChain/foss4gws.js</span></code> and
add the following content:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="n">zoo_url</span><span class="o">=</span><span class="s1">&#39;http://localhost/cgi-bin/zoo_loader.cgi&#39;</span><span class="p">;</span>
<span class="n">var</span> <span class="n">mapfile</span><span class="o">=</span><span class="s2">&quot;/var/data/maps/project_WS2024.map&quot;</span><span class="p">;</span>

<span class="n">function</span> <span class="n">Buffer</span><span class="p">(</span><span class="n">inputData</span><span class="p">,</span><span class="n">bDist</span><span class="p">){</span>

  <span class="o">//</span> <span class="n">Create</span> <span class="nb">all</span> <span class="n">required</span> <span class="n">ZOO</span><span class="o">.</span><span class="n">formats</span>
  <span class="n">var</span> <span class="n">fGJ</span><span class="o">=</span><span class="n">new</span> <span class="n">ZOO</span><span class="o">.</span><span class="n">Format</span><span class="o">.</span><span class="n">GeoJSON</span><span class="p">();</span>

  <span class="o">//</span> <span class="n">Call</span> <span class="n">the</span> <span class="n">Buffer</span> <span class="n">service</span>
  <span class="n">var</span> <span class="n">myInputs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">InputPolygon</span><span class="p">:</span> <span class="p">{</span> 
      <span class="nb">type</span><span class="p">:</span> <span class="s1">&#39;complex&#39;</span><span class="p">,</span>
      <span class="n">value</span><span class="p">:</span> <span class="n">fGJ</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">inputData</span><span class="p">),</span>
      <span class="n">mimeType</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">},</span>
      <span class="n">BufferDistance</span><span class="p">:</span> <span class="p">{</span>
        <span class="nb">type</span><span class="p">:</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span>
        <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">bDist</span>
      <span class="p">}</span>
  <span class="p">};</span>
  <span class="n">var</span> <span class="n">myOutputs</span><span class="o">=</span> <span class="p">{</span>
    <span class="n">Result</span><span class="p">:</span> <span class="p">{</span> 
      <span class="nb">type</span><span class="p">:</span> <span class="s1">&#39;RawDataOutput&#39;</span><span class="p">,</span>
      <span class="s2">&quot;mimeType&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="n">var</span> <span class="n">myProcess</span> <span class="o">=</span> <span class="n">new</span> <span class="n">ZOO</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">zoo_url</span><span class="p">,</span><span class="s1">&#39;Buffer&#39;</span><span class="p">);</span>
  <span class="n">var</span> <span class="n">myExecuteResult</span><span class="o">=</span><span class="n">myProcess</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">myInputs</span><span class="p">,</span><span class="n">myOutputs</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">fGJ</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">myExecuteResult</span><span class="p">);</span>

<span class="p">}</span>

<span class="n">function</span> <span class="n">BufferToBBOX</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span><span class="n">dist</span><span class="p">){</span>
  <span class="o">//</span> <span class="n">Create</span> <span class="nb">all</span> <span class="n">required</span> <span class="n">ZOO</span><span class="o">.</span><span class="n">formats</span>
  <span class="n">var</span> <span class="n">fGJ</span><span class="o">=</span><span class="n">new</span> <span class="n">ZOO</span><span class="o">.</span><span class="n">Format</span><span class="o">.</span><span class="n">GeoJSON</span><span class="p">();</span>
  <span class="n">var</span> <span class="n">fGML</span><span class="o">=</span><span class="n">new</span> <span class="n">ZOO</span><span class="o">.</span><span class="n">Format</span><span class="o">.</span><span class="n">GML</span><span class="p">();</span>
  <span class="k">if</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;InputData&quot;</span><span class="p">][</span><span class="s2">&quot;mimeType&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;application/json&quot;</span><span class="p">)</span>
      <span class="n">fGML</span><span class="o">=</span><span class="n">new</span> <span class="n">ZOO</span><span class="o">.</span><span class="n">Format</span><span class="o">.</span><span class="n">GeoJSON</span><span class="p">();</span>

  <span class="o">//</span> <span class="n">Read</span> <span class="n">the</span>   <span class="nb">input</span> <span class="n">GML</span>
  <span class="n">var</span> <span class="n">inputData</span><span class="o">=</span><span class="n">fGML</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;InputData&quot;</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]);</span>
  <span class="n">alert</span><span class="p">(</span><span class="n">inputData</span><span class="p">);</span>

  <span class="o">//</span> <span class="n">Compute</span> <span class="n">Buffer</span>
  <span class="n">var</span> <span class="n">bufferResultAsJSON</span><span class="o">=</span><span class="n">Buffer</span><span class="p">(</span><span class="n">inputData</span><span class="p">,</span><span class="n">dist</span><span class="p">);</span>
  <span class="n">alert</span><span class="p">(</span><span class="n">bufferResultAsJSON</span><span class="p">);</span>

  <span class="o">//</span> <span class="n">Create</span> <span class="n">the</span> <span class="n">Buffer</span> <span class="n">result</span> <span class="n">BBOX</span>
  <span class="n">var</span> <span class="n">bbox</span> <span class="o">=</span> <span class="n">new</span> <span class="n">ZOO</span><span class="o">.</span><span class="n">Bounds</span><span class="p">();</span>
  <span class="n">var</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bufferResultAsJSON</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">getVertices</span><span class="p">();</span>
  <span class="k">for</span><span class="p">(</span><span class="n">var</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">bounds</span><span class="p">){</span>
    <span class="n">bbox</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="n">t</span><span class="p">]);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="p">[</span><span class="n">bbox</span><span class="p">,</span><span class="n">bufferResultAsJSON</span><span class="p">,</span><span class="n">inputData</span><span class="p">];</span>
<span class="p">}</span>

<span class="n">function</span> <span class="n">Mask</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span><span class="n">inputs</span><span class="p">,</span><span class="n">outputs</span><span class="p">){</span>
  <span class="n">var</span> <span class="n">fGJ</span><span class="o">=</span><span class="n">new</span> <span class="n">ZOO</span><span class="o">.</span><span class="n">Format</span><span class="o">.</span><span class="n">GeoJSON</span><span class="p">();</span>
  <span class="n">var</span> <span class="n">bbox</span> <span class="o">=</span> <span class="n">BufferToBBOX</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span><span class="mf">0.15</span><span class="p">);</span>
  <span class="n">var</span> <span class="n">finalG</span><span class="o">=</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">toGeometry</span><span class="p">();</span>
  <span class="n">var</span> <span class="n">result</span><span class="o">=</span><span class="n">new</span> <span class="n">ZOO</span><span class="o">.</span><span class="n">Feature</span><span class="p">(</span><span class="n">finalG</span><span class="p">,{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Result1000&quot;</span><span class="p">});</span>
  <span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;Result&quot;</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">fGJ</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
  <span class="k">return</span> <span class="p">{</span><span class="n">result</span><span class="p">:</span> <span class="n">ZOO</span><span class="o">.</span><span class="n">SERVICE_SUCCEEDED</span><span class="p">,</span> <span class="n">outputs</span><span class="p">:</span> <span class="n">outputs</span> <span class="p">};</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="publish-and-use-your-service">
<h3><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Publish and use your Service</a><a class="headerlink" href="#publish-and-use-your-service" title="Link to this heading">¶</a></h3>
<p>Now you get both your ZCFG and your service code ready, you need to deploy your
new Services Provider using the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">$(</span>ls<span class="w"> </span>myChain<span class="k">)</span><span class="p">;</span>
<span class="k">do</span>
<span class="w">    </span>docker<span class="w"> </span>cp<span class="w"> </span>myChain/<span class="nv">$i</span><span class="w"> </span><span class="se">\</span>
<span class="w">            </span>zoo-project_zookernel_1:/usr/lib/cgi-bin/<span class="nv">$i</span><span class="w"> </span><span class="p">;</span>
<span class="k">done</span>
</pre></div>
</div>
<p>Now you are ready to use your JavaScript service by loading the following <a class="reference external" href="http://localhost/zoows-2024/">url</a>, click on a street then click on
the “Mask” button.</p>
</section>
</section>
<section id="buffermask-service">
<h2><a class="toc-backref" href="#table-of-contents" role="doc-backlink">BufferMask Service</a><a class="headerlink" href="#buffermask-service" title="Link to this heading">¶</a></h2>
<p>In this section you will implement a simple JavaScript service which will be able create
a hole in the mask you created in <a class="reference external" href="#mask-service">previous section</a>. This service
will be used to highlight the buffer zone around a selected fature. You get a preview of
the expected result in the following screenshot:</p>
<a class="reference internal image-reference" href="../../_images/BufferMask_Level_158.png"><img alt="../../_images/BufferMask_Level_158.png" class="align-center" src="../../_images/BufferMask_Level_158.png" style="width: 650px;" />
</a>
<section id="id6">
<h3><a class="toc-backref" href="#table-of-contents" role="doc-backlink">The ZCFG</a><a class="headerlink" href="#id6" title="Link to this heading">¶</a></h3>
<p>Open the file named
<code class="docutils literal notranslate"><span class="pre">myChain/BufferMask.zcfg</span></code>
with your favorite text editor and copy / paste the following content:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">BufferMask</span><span class="p">]</span>
 <span class="n">Title</span> <span class="o">=</span> <span class="n">Compute</span> <span class="n">buffer</span> <span class="n">mask</span>
 <span class="n">Abstract</span> <span class="o">=</span> <span class="n">Compute</span> <span class="n">buffer</span> <span class="n">mask</span> <span class="n">around</span> <span class="n">a</span> <span class="n">geometry</span>
 <span class="n">processVersion</span> <span class="o">=</span> <span class="mi">1</span>
 <span class="n">storeSupported</span> <span class="o">=</span> <span class="n">true</span>
 <span class="n">statusSupported</span> <span class="o">=</span> <span class="n">true</span>
 <span class="n">serviceProvider</span> <span class="o">=</span> <span class="n">foss4gws</span><span class="o">.</span><span class="n">js</span>
 <span class="n">serviceType</span> <span class="o">=</span> <span class="n">JS</span>
 <span class="o">&lt;</span><span class="n">DataInputs</span><span class="o">&gt;</span>
  <span class="p">[</span><span class="n">InputData</span><span class="p">]</span>
   <span class="n">Title</span> <span class="o">=</span> <span class="n">The</span> <span class="n">feature</span>
   <span class="n">Abstract</span> <span class="o">=</span> <span class="n">The</span> <span class="n">feature</span> <span class="n">to</span> <span class="n">run</span> <span class="n">the</span> <span class="n">service</span> <span class="k">with</span>
   <span class="n">minOccurs</span> <span class="o">=</span> <span class="mi">1</span>
   <span class="n">maxOccurs</span> <span class="o">=</span> <span class="mi">1</span>
   <span class="o">&lt;</span><span class="n">ComplexData</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">Default</span><span class="o">&gt;</span>
    <span class="n">mimeType</span> <span class="o">=</span> <span class="n">text</span><span class="o">/</span><span class="n">xml</span>
    <span class="n">encoding</span> <span class="o">=</span> <span class="n">utf</span><span class="o">-</span><span class="mi">8</span>
    <span class="o">&lt;/</span><span class="n">Default</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">ComplexData</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">DataInputs</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">DataOutputs</span><span class="o">&gt;</span>
  <span class="p">[</span><span class="n">Result</span><span class="p">]</span>
   <span class="n">Title</span> <span class="o">=</span> <span class="n">The</span> <span class="n">resulting</span> <span class="n">feature</span>
   <span class="n">Abstract</span> <span class="o">=</span> <span class="n">The</span> <span class="n">feature</span> <span class="n">created</span> <span class="n">by</span> <span class="n">the</span> <span class="n">service</span><span class="o">.</span>
   <span class="o">&lt;</span><span class="n">ComplexOutput</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">Default</span><span class="o">&gt;</span>
     <span class="n">mimeType</span> <span class="o">=</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span>
     <span class="o">&lt;/</span><span class="n">Default</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">ComplexOutput</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">DataOutputs</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This ZCFG is similar to the previous one. Please, refer to comments in the
<a class="reference external" href="#the-zcfg">previous section</a> for more informations.</p>
</section>
<section id="id7">
<h3><a class="toc-backref" href="#table-of-contents" role="doc-backlink">The JavaScript service</a><a class="headerlink" href="#id7" title="Link to this heading">¶</a></h3>
<p>In this Service you will use same source code you used in the
<a class="reference external" href="#the-javascript-service">previous section</a>. Indeed, you should
compute the Mask as you did before then compute Buffer for creating a
hole in the mask to run the Difference service.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">BufferMask</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span><span class="n">inputs</span><span class="p">,</span><span class="n">outputs</span><span class="p">){</span>

  <span class="o">//</span> <span class="n">Compute</span> <span class="n">big</span> <span class="n">Buffer</span>
  <span class="n">var</span> <span class="n">bbox</span> <span class="o">=</span> <span class="n">BufferToBBOX</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span><span class="mf">0.15</span><span class="p">);</span>
  <span class="n">var</span> <span class="n">finalG</span><span class="o">=</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">toGeometry</span><span class="p">();</span>
  <span class="n">var</span> <span class="n">fGJ</span><span class="o">=</span><span class="n">new</span> <span class="n">ZOO</span><span class="o">.</span><span class="n">Format</span><span class="o">.</span><span class="n">GeoJSON</span><span class="p">();</span>

  <span class="o">//</span> <span class="n">Compute</span> <span class="n">Buffer</span> <span class="n">standard</span> <span class="n">buffer</span>
  <span class="n">var</span> <span class="n">bufferResultAsJSON</span><span class="o">=</span><span class="n">Buffer</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="mf">0.0015</span><span class="p">);</span>

  <span class="o">//</span> <span class="n">Request</span> <span class="n">Difference</span> <span class="n">service</span> <span class="n">using</span> <span class="n">Buffer</span> <span class="n">result</span> <span class="ow">and</span> <span class="n">features</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">BBOX</span>
  <span class="n">var</span> <span class="n">result</span><span class="o">=</span><span class="n">new</span> <span class="n">ZOO</span><span class="o">.</span><span class="n">Feature</span><span class="p">(</span><span class="n">finalG</span><span class="p">,{</span><span class="s2">&quot;fid&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Result1000&quot;</span><span class="p">});</span>
  <span class="n">var</span> <span class="n">myProcess2</span> <span class="o">=</span> <span class="n">new</span> <span class="n">ZOO</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">zoo_url</span><span class="p">,</span><span class="s1">&#39;Difference&#39;</span><span class="p">);</span>
  <span class="n">var</span> <span class="n">myInputs2</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">InputEntity1</span><span class="p">:</span> <span class="p">{</span>
      <span class="nb">type</span><span class="p">:</span> <span class="s1">&#39;complex&#39;</span><span class="p">,</span>
      <span class="n">value</span><span class="p">:</span> <span class="n">fGJ</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">finalG</span><span class="p">),</span>
      <span class="n">mimeType</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span>
    <span class="p">},</span>
    <span class="n">InputEntity2</span><span class="p">:</span> <span class="p">{</span>
      <span class="nb">type</span><span class="p">:</span> <span class="s1">&#39;complex&#39;</span><span class="p">,</span>
      <span class="n">value</span><span class="p">:</span> <span class="n">fGJ</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">bufferResultAsJSON</span><span class="p">),</span>
      <span class="n">mimeType</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="n">var</span> <span class="n">myOutputs2</span><span class="o">=</span> <span class="p">{</span>
    <span class="n">Result</span><span class="p">:</span> <span class="p">{</span>
      <span class="nb">type</span><span class="p">:</span> <span class="s1">&#39;RawDataOutput&#39;</span><span class="p">,</span>
      <span class="s2">&quot;mimeType&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="n">var</span> <span class="n">myExecuteResult4</span><span class="o">=</span><span class="n">myProcess2</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">myInputs2</span><span class="p">,</span><span class="n">myOutputs2</span><span class="p">);</span>

  <span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;Result&quot;</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">myExecuteResult4</span><span class="p">;</span>
  <span class="k">return</span> <span class="p">{</span><span class="n">result</span><span class="p">:</span> <span class="n">ZOO</span><span class="o">.</span><span class="n">SERVICE_SUCCEEDED</span><span class="p">,</span> <span class="n">outputs</span><span class="p">:</span> <span class="n">outputs</span> <span class="p">};</span>

<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id8">
<h3><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Publish and use your Service</a><a class="headerlink" href="#id8" title="Link to this heading">¶</a></h3>
<p>Now, you can publish your service as you did <a class="reference external" href="#publish-and-use-your-service">before</a>. To use your service, please use
the following <a class="reference external" href="http://localhost/zoows-2024/">url</a>.</p>
</section>
</section>
<section id="bufferrequest-service">
<h2><a class="toc-backref" href="#table-of-contents" role="doc-backlink">BufferRequest service</a><a class="headerlink" href="#bufferrequest-service" title="Link to this heading">¶</a></h2>
<p>In this section, you will create a new Service: <code class="docutils literal notranslate"><span class="pre">BufferRequest</span></code> which will request
POIs included in the Buffer around a selected feature <a class="footnote-reference brackets" href="#f8" id="id9" role="doc-noteref"><span class="fn-bracket">[</span>6<span class="fn-bracket">]</span></a>. You will use the <code class="docutils literal notranslate"><span class="pre">poi</span></code>
layer served as WFS through your local mapserver installation. You can see in the
following screenshot the expected result:</p>
<a class="reference internal image-reference" href="../../_images/BufferRequest_Level_158.png"><img alt="../../_images/BufferRequest_Level_158.png" class="align-center" src="../../_images/BufferRequest_Level_158.png" style="width: 650px;" />
</a>
<section id="id10">
<h3><a class="toc-backref" href="#table-of-contents" role="doc-backlink">The ZCFG</a><a class="headerlink" href="#id10" title="Link to this heading">¶</a></h3>
<p>Open the file named
<code class="docutils literal notranslate"><span class="pre">myChain/BufferRequest.zcfg</span></code>
with your favorite text editor and copy / paste the following content:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">BufferRequest</span><span class="p">]</span>
 <span class="n">Title</span> <span class="o">=</span> <span class="n">Compute</span> <span class="n">buffer</span> <span class="n">request</span>
 <span class="n">Abstract</span> <span class="o">=</span> <span class="n">Compute</span> <span class="n">buffer</span> <span class="n">request</span> <span class="n">around</span> <span class="n">a</span> <span class="n">geometry</span>
 <span class="n">processVersion</span> <span class="o">=</span> <span class="mi">1</span>
 <span class="n">storeSupported</span> <span class="o">=</span> <span class="n">true</span>
 <span class="n">statusSupported</span> <span class="o">=</span> <span class="n">true</span>
 <span class="n">serviceProvider</span> <span class="o">=</span> <span class="n">foss4gws</span><span class="o">.</span><span class="n">js</span>
 <span class="n">serviceType</span> <span class="o">=</span> <span class="n">JS</span>
 <span class="o">&lt;</span><span class="n">DataInputs</span><span class="o">&gt;</span>
  <span class="p">[</span><span class="n">InputData</span><span class="p">]</span>
   <span class="n">Title</span> <span class="o">=</span> <span class="n">The</span> <span class="n">feature</span>
   <span class="n">Abstract</span> <span class="o">=</span> <span class="n">The</span> <span class="n">feature</span> <span class="n">to</span> <span class="n">run</span> <span class="n">the</span> <span class="n">service</span> <span class="k">with</span>
   <span class="n">minOccurs</span> <span class="o">=</span> <span class="mi">1</span>
   <span class="n">maxOccurs</span> <span class="o">=</span> <span class="mi">1</span>
   <span class="o">&lt;</span><span class="n">ComplexData</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">Default</span><span class="o">&gt;</span>
    <span class="n">mimeType</span> <span class="o">=</span> <span class="n">text</span><span class="o">/</span><span class="n">xml</span>
    <span class="n">encoding</span> <span class="o">=</span> <span class="n">utf</span><span class="o">-</span><span class="mi">8</span>
    <span class="o">&lt;/</span><span class="n">Default</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">ComplexData</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">DataInputs</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">DataOutputs</span><span class="o">&gt;</span>
  <span class="p">[</span><span class="n">Result</span><span class="p">]</span>
   <span class="n">Title</span> <span class="o">=</span> <span class="n">The</span> <span class="n">resulting</span> <span class="n">feature</span>
   <span class="n">Abstract</span> <span class="o">=</span> <span class="n">The</span> <span class="n">feature</span> <span class="n">created</span> <span class="n">by</span> <span class="n">the</span> <span class="n">service</span><span class="o">.</span>
   <span class="o">&lt;</span><span class="n">ComplexOutput</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">Default</span><span class="o">&gt;</span>
     <span class="n">mimeType</span> <span class="o">=</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span>
     <span class="o">&lt;/</span><span class="n">Default</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">ComplexOutput</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">DataOutputs</span><span class="o">&gt;</span>
</pre></div>
</div>
</section>
<section id="the-javascript-code">
<h3><a class="toc-backref" href="#table-of-contents" role="doc-backlink">The JavaScript code</a><a class="headerlink" href="#the-javascript-code" title="Link to this heading">¶</a></h3>
<p>As in the previous Service, you will compute a buffer around the input feature. But then
you will request POIs available in the Buffer extent using a WFS request to use them to
run <code class="docutils literal notranslate"><span class="pre">Intersection</span></code> service using the initial Buffer. The WFS request is useful to limit
the number of points to use when requesting the <code class="docutils literal notranslate"><span class="pre">Intersection</span></code> Service.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">BufferRequest</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span><span class="n">inputs</span><span class="p">,</span><span class="n">outputs</span><span class="p">){</span>

  <span class="n">var</span> <span class="n">fGJ</span><span class="o">=</span><span class="n">new</span> <span class="n">ZOO</span><span class="o">.</span><span class="n">Format</span><span class="o">.</span><span class="n">GeoJSON</span><span class="p">();</span>
  <span class="n">var</span> <span class="n">bbox</span><span class="o">=</span><span class="n">BufferToBBOX</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span><span class="mf">0.0015</span><span class="p">);</span>
  <span class="n">var</span> <span class="n">myProcess2</span> <span class="o">=</span> <span class="n">new</span> <span class="n">ZOO</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">zoo_url</span><span class="p">,</span><span class="s1">&#39;Intersection&#39;</span><span class="p">);</span>
  <span class="n">var</span> <span class="n">myInputs2</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">InputEntity1</span><span class="p">:</span> <span class="p">{</span>
      <span class="nb">type</span><span class="p">:</span> <span class="s1">&#39;complex&#39;</span><span class="p">,</span>
      <span class="n">value</span><span class="p">:</span> <span class="n">fGJ</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
      <span class="n">mimeType</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span>
    <span class="p">},</span>
    <span class="n">InputEntity2</span><span class="p">:</span> <span class="p">{</span>
      <span class="nb">type</span><span class="p">:</span> <span class="s1">&#39;complex&#39;</span><span class="p">,</span>
      <span class="n">xlink</span><span class="p">:</span> <span class="s2">&quot;http://localhost/cgi-bin/mapserv?map=&quot;</span><span class="o">+</span><span class="n">mapfile</span><span class="o">+</span>
        <span class="s2">&quot;&amp;amp;SERVICE=WFS&amp;amp;version=1.0.0&amp;amp;request=GetFeature&amp;amp;&quot;</span><span class="o">+</span>
        <span class="s2">&quot;typename=points&amp;amp;SRS=EPSG:4326&amp;amp;BBOX=&quot;</span><span class="o">+</span>
        <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">left</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">bottom</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">right</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">top</span><span class="p">,</span>
      <span class="n">mimeType</span><span class="p">:</span> <span class="s2">&quot;text/xml&quot;</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="n">var</span> <span class="n">myOutputs2</span><span class="o">=</span> <span class="p">{</span>
    <span class="n">Result</span><span class="p">:</span> <span class="p">{</span>
      <span class="nb">type</span><span class="p">:</span> <span class="s1">&#39;RawDataOutput&#39;</span><span class="p">,</span>
      <span class="s2">&quot;mimeType&quot;</span><span class="p">:</span> <span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;Result&quot;</span><span class="p">][</span><span class="s2">&quot;mimeType&quot;</span><span class="p">]</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="n">var</span> <span class="n">myExecuteResult4</span><span class="o">=</span><span class="n">myProcess2</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">myInputs2</span><span class="p">,</span><span class="n">myOutputs2</span><span class="p">);</span>
  <span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;Result&quot;</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">myExecuteResult4</span><span class="p">;</span>
  <span class="k">return</span> <span class="p">{</span><span class="n">result</span><span class="p">:</span> <span class="n">ZOO</span><span class="o">.</span><span class="n">SERVICE_SUCCEEDED</span><span class="p">,</span> <span class="n">outputs</span><span class="p">:</span> <span class="n">outputs</span> <span class="p">};</span>

<span class="p">}</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>to take advantage of the ZOO-Kernel cache system, you directly use the WFS
request  as <code class="docutils literal notranslate"><span class="pre">xlink:href</span></code> rather than value for <code class="docutils literal notranslate"><span class="pre">InputEntity2</span></code> (from line 31 to 34) and use <code class="docutils literal notranslate"><span class="pre">text/xml</span></code> <code class="docutils literal notranslate"><span class="pre">mimeType</span></code>
(on line 40). Indeed, the ZOO-API doesn’t use the internal cache mechanisms.</p>
</div>
</section>
<section id="id11">
<h3><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Publish and use your Service</a><a class="headerlink" href="#id11" title="Link to this heading">¶</a></h3>
<p>Now, you can publish your service as you did <a class="reference external" href="#publish-and-use-your-service">before</a>. To use your service, please use
the following <a class="reference external" href="http://localhost/zoows-2024/">url</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can click on “Buffer Request and Mask”  to get the same result as presented
in  <a class="reference external" href="#introduction">the initial screenshot</a>.</p>
</div>
</section>
</section>
<section id="conclusion">
<h2><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Conclusion</a><a class="headerlink" href="#conclusion" title="Link to this heading">¶</a></h2>
<p>After understanding how basic Geometric Operation Services works, here you built step by step new JavaScript services which reuse the previous ones and combine them in different ways. This was achieved using the ZOO-API, composed by C functions exposed by the ZOO-Kernel to the JavaScript services runtime environement and the JS files which can be optionally installed.</p>
<p class="rubric">Footnotes</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="f3" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>The <code class="docutils literal notranslate"><span class="pre">ZOO.Process</span></code> class uses <code class="docutils literal notranslate"><span class="pre">JSRequest</span></code> (cf. <a class="reference external" href="http://zoo-project.org/docs/api/zoo-format-wps.html">ref</a>). You will get example
of use <a class="reference external" href="#the-javascript-service">later</a>.</p>
</aside>
<aside class="footnote brackets" id="f4" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>So <code class="docutils literal notranslate"><span class="pre">conf</span></code>, <code class="docutils literal notranslate"><span class="pre">inputs</span></code> and <code class="docutils literal notranslate"><span class="pre">outputs</span></code> are simple JavaScript objects, similar
to the Python dictionaries used in the <a class="reference external" href="ogr_base_vect_ops.html">previous section</a>.</p>
</aside>
<aside class="footnote brackets" id="f5" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">3</a><span class="fn-bracket">]</span></span>
<p>Such as <code class="docutils literal notranslate"><span class="pre">conf</span></code>, <code class="docutils literal notranslate"><span class="pre">inputs</span></code> and <code class="docutils literal notranslate"><span class="pre">outputs</span></code>.</p>
</aside>
<aside class="footnote brackets" id="f6" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id4">4</a><span class="fn-bracket">]</span></span>
<p>You can also return a conf Object if you get any informations updated from your JavaScript service (such as cookie for instance)</p>
</aside>
<aside class="footnote brackets" id="f7" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id5">5</a><span class="fn-bracket">]</span></span>
<p>Using one of the available <code class="docutils literal notranslate"><span class="pre">ZOO.formats</span></code> you are also able to support various
<code class="docutils literal notranslate"><span class="pre">ComplexData</span></code> for both input and output of the service. To simplify the
presentation here, you will use only this default ones.</p>
</aside>
<aside class="footnote brackets" id="f8" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id9">6</a><span class="fn-bracket">]</span></span>
<p>So in the hole you created in the previous section.</p>
</aside>
</aside>
</section>
</section>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="solutions.html" class="btn btn-neutral float-right" title="Issue playing with building blocks?">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="building_blocks_presentation.html" class="btn btn-neutral" title="Building blocks presentation"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>
  <div class="pfoot">
  <div role="contentinfo">
    <p>
        &copy; Copyright 2009-2023, ZOO-Project team. This work is released under a Creative Commons Attribution-ShareAlike 4.0 International Public License.
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> inspired by <a href="https://readthedocs.org">Read the Docs</a>.
</div>
</footer>

        </div>
      </div>

    </section>

  </div>
  


  
    <div id="documentation_options" data-version="1.7" data-url_root="../../"></div>
    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.7',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/sphinx_highlight.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>